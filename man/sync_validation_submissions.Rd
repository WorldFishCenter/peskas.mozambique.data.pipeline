% Generated by roxygen2: do not edit by hand
% Please edit documentation in R/validation.R
\name{sync_validation_submissions}
\alias{sync_validation_submissions}
\title{Synchronize Validation Statuses with KoboToolbox}
\usage{
sync_validation_submissions(log_threshold = logger::DEBUG)
}
\arguments{
\item{log_threshold}{The logging level threshold for the logger package (e.g., DEBUG, INFO).
Default is logger::DEBUG.}
}
\value{
None. The function performs status updates and database operations as side effects.
}
\description{
Synchronizes validation statuses between the local system and KoboToolbox by processing
validation flags and updating submission statuses accordingly. This function follows the
Kenya pipeline pattern with rate limiting, manual approval respect, and optimized API usage.
}
\details{
The function follows these steps:
\enumerate{
\item Downloads the current validation flags from cloud storage
\item Sets up parallel processing with rate limiting
\item Fetches current validation status from KoboToolbox FIRST (before any updates)
\item Identifies manually approved submissions (excluding system username)
\item Updates flagged submissions as "not approved" (EXCLUDING manual approvals)
\item Updates clean submissions as "approved" (SKIPPING already-approved ones)
\item Fetches final validation status after updates
\item Combines results and pushes to MongoDB for record-keeping
}

Key improvements over previous implementation:
\itemize{
\item Rate limiting prevents overwhelming KoboToolbox API
\item Manual approvals are respected and never overwritten
\item Already-approved submissions are skipped to minimize API calls
\item Better error tracking and logging
}
}
\note{
This function requires proper configuration in the config file, including:
\itemize{
\item MongoDB connection parameters
\item KoboToolbox asset ID and token (configured under ingestion$kobo-adnap)
\item KoboToolbox username (to identify system approvals)
\item Google cloud storage parameters
}
}
\section{Parallel Processing}{

The function uses the future and furrr packages for parallel processing, with the number
of workers set to system cores minus 2 to prevent resource exhaustion. Rate limiting is
implemented via Sys.sleep() to respect API constraints.
}

\examples{
\dontrun{
# Run with default DEBUG logging
sync_validation_submissions()

# Run with INFO level logging
sync_validation_submissions(log_threshold = logger::INFO)
}

}
\seealso{
\itemize{
\item \code{\link[=process_submissions_parallel]{process_submissions_parallel()}} for the helper function with rate limiting
\item \code{\link[=get_validation_status]{get_validation_status()}} for fetching KoboToolbox validation status
\item \code{\link[=update_validation_status]{update_validation_status()}} for updating KoboToolbox validation status
}
}
\keyword{validation}
\keyword{workflow}
