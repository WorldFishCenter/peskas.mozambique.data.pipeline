<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en"><head><meta http-equiv="Content-Type" content="text/html; charset=UTF-8"><meta charset="utf-8"><meta http-equiv="X-UA-Compatible" content="IE=edge"><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><title>Reshape Catch Data with Length Groupings — reshape_catch_data • peskas.mozambique.data.pipeline</title><script src="../deps/jquery-3.6.0/jquery-3.6.0.min.js"></script><meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no"><link href="../deps/bootstrap-5.3.1/bootstrap.min.css" rel="stylesheet"><script src="../deps/bootstrap-5.3.1/bootstrap.bundle.min.js"></script><link href="../deps/IBM_Plex_Sans-0.4.10/font.css" rel="stylesheet"><link href="../deps/Fira_Mono-0.4.10/font.css" rel="stylesheet"><link href="../deps/Alegreya_Sans_SC-0.4.10/font.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/all.min.css" rel="stylesheet"><link href="../deps/font-awesome-6.5.2/css/v4-shims.min.css" rel="stylesheet"><script src="../deps/headroom-0.11.0/headroom.min.js"></script><script src="../deps/headroom-0.11.0/jQuery.headroom.min.js"></script><script src="../deps/bootstrap-toc-1.0.1/bootstrap-toc.min.js"></script><script src="../deps/clipboard.js-2.0.11/clipboard.min.js"></script><script src="../deps/search-1.0.0/autocomplete.jquery.min.js"></script><script src="../deps/search-1.0.0/fuse.min.js"></script><script src="../deps/search-1.0.0/mark.min.js"></script><!-- pkgdown --><script src="../pkgdown.js"></script><meta property="og:title" content="Reshape Catch Data with Length Groupings — reshape_catch_data"><meta name="description" content="This function takes KoBoToolbox survey data with species catch information and reshapes
it into long format while properly handling nested length group information. It supports
both regular length groups (under 100cm) and separate structures for fish over 100cm."><meta property="og:description" content="This function takes KoBoToolbox survey data with species catch information and reshapes
it into long format while properly handling nested length group information. It supports
both regular length groups (under 100cm) and separate structures for fish over 100cm."></head><body>
    <a href="#main" class="visually-hidden-focusable">Skip to contents</a>


    <nav class="navbar navbar-expand-lg fixed-top bg-light" data-bs-theme="light" aria-label="Site navigation"><div class="container">

    <a class="navbar-brand me-2" href="../index.html">peskas.mozambique.data.pipeline</a>

    <small class="nav-text text-muted me-auto" data-bs-toggle="tooltip" data-bs-placement="bottom" title="">2.3.0</small>


    <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbar" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
      <span class="navbar-toggler-icon"></span>
    </button>

    <div id="navbar" class="collapse navbar-collapse ms-3">
      <ul class="navbar-nav me-auto"><li class="active nav-item"><a class="nav-link" href="../reference/index.html">Reference</a></li>
<li class="nav-item"><a class="nav-link" href="../news/index.html">Changelog</a></li>
      </ul><ul class="navbar-nav"><li class="nav-item"><form class="form-inline" role="search">
 <input class="form-control" type="search" name="search-input" id="search-input" autocomplete="off" aria-label="Search site" placeholder="Search for" data-search-index="../search.json"></form></li>
      </ul></div>


  </div>
</nav><div class="container template-reference-topic">
<div class="row">
  <main id="main" class="col-md-9"><div class="page-header">

      <h1>Reshape Catch Data with Length Groupings</h1>

      <div class="d-none name"><code>reshape_catch_data.Rd</code></div>
    </div>

    <div class="ref-description section level2">
    <p>This function takes KoBoToolbox survey data with species catch information and reshapes
it into long format while properly handling nested length group information. It supports
both regular length groups (under 100cm) and separate structures for fish over 100cm.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-usage">Usage<a class="anchor" aria-label="anchor" href="#ref-usage"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span><span class="fu">reshape_catch_data</span><span class="op">(</span>df <span class="op">=</span> <span class="cn">NULL</span><span class="op">)</span></span></code></pre></div>
    </div>

    <div class="section level2">
    <h2 id="arguments">Arguments<a class="anchor" aria-label="anchor" href="#arguments"></a></h2>


<dl><dt id="arg-df">df<a class="anchor" aria-label="anchor" href="#arg-df"></a></dt>
<dd><p>A data frame containing catch data with species groups and length information.
Expected to have columns following the pattern:</p><ul><li><p>species_group.X columns (where X is a position number)</p></li>
<li><p>Multiple species fields within each group (species_TL, species_RF, species_SH, etc.)</p></li>
<li><p>Optional regular length group columns (species_group.X.species_group/no_fish_by_length_group/no_individuals_Y_Z)</p></li>
<li><p>Optional over-100cm length group columns (species_group/no_fish_by_length_group_100/)</p></li>
</ul></dd>

</dl></div>
    <div class="section level2">
    <h2 id="value">Value<a class="anchor" aria-label="anchor" href="#value"></a></h2>
    <p>A data frame in long format with each row representing a species catch record.
The output includes columns:
- submission_id: Unique survey submission identifier
- n_catch: Catch record number within submission (1-based)
- counting_method: Method used to count/measure catch
- species: FAO 3-alpha species code (normalized from multiple species_* fields)
- n_buckets, weight_bucket, catch_weight: Bucket-based measurements
- length_range: Length category (e.g., "5_10", "over100")
- length_over: Specific length for fish over 100cm
- count: Number of individuals in that length range</p>
    </div>
    <div class="section level2">
    <h2 id="details">Details<a class="anchor" aria-label="anchor" href="#details"></a></h2>
    <p>The function performs the following steps:</p><ol><li><p>Reshapes species groups from wide to long using <code><a href="reshape_species_groups.html">reshape_species_groups()</a></code></p></li>
<li><p>Normalizes multiple species fields (species_TL for teleosts, species_RF for rays/fish,
species_SH for sharks, species_FSH for finfish, species_CRB for crabs, species_CE for
cephalopods, species_LO for lobster, species_CR for crustacea, species_MA for marine animals,
species_OY for oysters, species_FI for fish, species_FFI for flatfish, species_RA for rays,
species_SHK for sharks, species_MZZ for miscellaneous) into a single 'species' column</p></li>
<li><p>Processes each species row individually using <code><a href="expand_length_frequency.html">expand_length_frequency()</a></code> to:</p><ul><li><p>Check if length frequency data exists for that row</p></li>
<li><p>If yes: expand to multiple rows (one per length bin)</p></li>
<li><p>If no: keep single row with NA for length fields</p></li>
<li><p>Always preserve all metadata (counting_method, species, etc.)</p></li>
</ul></li>
<li><p>Removes length group columns after pivoting</p></li>
<li><p>Sorts by submission_id and n_catch</p></li>
</ol><p>This approach is simpler and more robust than the old extract-and-join method,
as it processes each species row individually and preserves all metadata throughout.</p>
    </div>

    <div class="section level2">
    <h2 id="ref-examples">Examples<a class="anchor" aria-label="anchor" href="#ref-examples"></a></h2>
    <div class="sourceCode"><pre class="sourceCode r"><code><span class="r-in"><span><span class="kw">if</span> <span class="op">(</span><span class="cn">FALSE</span><span class="op">)</span> <span class="op">{</span> <span class="co"># \dontrun{</span></span></span>
<span class="r-in"><span><span class="co"># Reshape catch data from raw survey</span></span></span>
<span class="r-in"><span><span class="va">catch_long</span> <span class="op">&lt;-</span> <span class="fu">reshape_catch_data</span><span class="op">(</span><span class="va">raw_survey_data</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># Analyze counts by length range</span></span></span>
<span class="r-in"><span><span class="va">catch_long</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="op">!</span><span class="fu"><a href="https://rdrr.io/r/base/NA.html" class="external-link">is.na</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/group_by.html" class="external-link">group_by</a></span><span class="op">(</span><span class="va">species</span>, <span class="va">length_range</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/summarise.html" class="external-link">summarize</a></span><span class="op">(</span>total_count <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/sum.html" class="external-link">sum</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/numeric.html" class="external-link">as.numeric</a></span><span class="op">(</span><span class="va">count</span><span class="op">)</span>, na.rm <span class="op">=</span> <span class="cn">TRUE</span><span class="op">)</span><span class="op">)</span></span></span>
<span class="r-in"><span></span></span>
<span class="r-in"><span><span class="co"># View fish over 100cm with their specific lengths</span></span></span>
<span class="r-in"><span><span class="va">catch_long</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/filter.html" class="external-link">filter</a></span><span class="op">(</span><span class="va">length_range</span> <span class="op">==</span> <span class="st">"over100"</span><span class="op">)</span> <span class="op">|&gt;</span></span></span>
<span class="r-in"><span>  <span class="fu">dplyr</span><span class="fu">::</span><span class="fu"><a href="https://dplyr.tidyverse.org/reference/select.html" class="external-link">select</a></span><span class="op">(</span><span class="va">submission_id</span>, <span class="va">species</span>, <span class="va">length_over</span>, <span class="va">count</span><span class="op">)</span></span></span>
<span class="r-in"><span><span class="op">}</span> <span class="co"># }</span></span></span>
</code></pre></div>
    </div>
  </main><aside class="col-md-3"><nav id="toc" aria-label="Table of contents"><h2>On this page</h2>
    </nav></aside></div>


    <footer><div class="pkgdown-footer-left">
  <p>Developed by First Last.</p>
</div>

<div class="pkgdown-footer-right">
  <p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.2.0.</p>
</div>

    </footer></div>





  </body></html>

